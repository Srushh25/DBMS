Practical No:-07


CREATE DATABASE LIB;
USE LIB;
CREATE TABLE BORROW(RNO INT,NAME VARCHAR(20),DATEOFISSUE DATE,BNAME VARCHAR(20),STATUS VARCHAR(20));
INSERT INTO BORROW VALUES(1,"RAM","2022-03-23","DBMS","I"),(2,"KAVYA","2022-12-12","SPOS","I"),(3,"SHAM","2022-06-20","TOC","I");
CREATE TABLE FINE(RNO INT,DATEOFRETURN DATE,AMT INT);

CREATE PROCEDURE CALFINE(IN P_RNO INT,IN P_BNAME VARCHAR(20))
BEGIN
DECLARE V_DATEOFISSUE DATE;
DECLARE V_DAYS INT;
DECLARE V_FINE INT;
SELECT DATEOFISSUE INTO V_DATEOFISSUE FROM BORROW WHERE RNO=P_RNO AND 'BNAME'=P_BNAME;
SET V_DAYS=DATEDIFF(CURDATE(),V_DATEOFISSUE);
IF V_DAYS BETWEEN 15 ABD 30 THEN SET V_FINE=V_DAYS*5;
ELSEIF V_DAYS>30 THEN SET V_FINE=V_DAYS*50;
ELSE SET V_FINE=0;
END IF;
IF(V_FINE IS NOT NULL) THEN INSERT INTO FINE(RNO,DATEOFRETURN,AMT) VALUES(P_RNO,CURDATE(),V_FINE);
UPDATE BORROW SET STATUS='R' WHERE RNO=P_RNO AND 'BNAME'=P_BNAME;
END IF;
END ;

